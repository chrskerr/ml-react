{"version":3,"sources":["Home.js","App.js","webpack:///./src/index.js?b635"],"names":["GET_VERSIONS","gql","GET_PREDICTIONS","Home","useState","instrument","setInstrument","version","setVersion","versionsData","useQuery","data","useLazyQuery","getPredictions","loading","useEffect","variables","allPredictions","_","get","versionsPredictions","filter","versions","map","Math","max","instruments","uniq","first","instrumentsVersionsPredictions","className","value","onChange","e","target","isEmpty","key","icon","faSpinner","spin","size","DotChart","memo","graphData","actual","prediction","toFixed","regressionData","largestVal","reduce","total","current","abs","Infinity","domain","ceil","regressionLineFunc","linearRegressionLine","linearRegression","regressionLine","margin","top","bottom","type","dataKey","name","label","position","offset","angle","cursor","strokeDasharray","fill","shape","line","stroke","strokeWidth","isEqual","DistributionChart","variations","Number","smallest","min","largest","intervalLength","range","i","middle","matchedVariations","variation","left","dot","Stats","sampleCount","App","client","ApolloClient","uri","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.a0476f5a.chunk.js","sourcesContent":["\nimport React, { memo, useEffect, useState } from \"react\";\nimport PropTypes from \"proptypes\";\nimport { useQuery, useLazyQuery } from \"@apollo/react-hooks\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faSpinner } from \"@fortawesome/free-solid-svg-icons\";\nimport _ from \"lodash\";\nimport gql from \"graphql-tag\";\nimport { ResponsiveContainer, ScatterChart, Scatter, XAxis, YAxis, CartesianGrid, Tooltip, LineChart, Line } from \"recharts\";\nimport { linearRegression, linearRegressionLine, min, max } from \"simple-statistics\";\n\nconst GET_VERSIONS = gql`\nquery GetVersions {\n    versions { id }\n}\n`;\n\nconst GET_PREDICTIONS = gql`\nquery GetPredictions ( $version: Int! ) {\n    predictions ( where: { prediction: { _is_null: false }, actual: { _is_null: false }, _version: { _eq: $version }}) {\n        actual id time\n        instrument\n        prediction\n        _version\n    }\n}`;\n\nexport default function Home () {\n\tconst [ instrument, setInstrument ] = useState( false );\n\tconst [ version, setVersion ] = useState( false );\n    \n\tconst { data: versionsData } = useQuery( GET_VERSIONS );\n\tconst [ getPredictions, { data, loading }] = useLazyQuery( GET_PREDICTIONS );\n\t// eslint-disable-next-line\n\tuseEffect(() => getPredictions({ variables: { version }}), [ version ]);\n\n\tconst allPredictions = _.get( data, \"predictions\" );\n\tconst versionsPredictions = _.filter( allPredictions, [ \"_version\", version ]);\n\n\tconst versions = _.map( _.get( versionsData, \"versions\" ), \"id\" );\n\t// eslint-disable-next-line\n\tuseEffect(() => { if ( !version ) setVersion( Math.max( versions )); }, [ versions ]);\n\n\tconst instruments = _.uniq( _.map( versionsPredictions, \"instrument\" ));\n\t// eslint-disable-next-line\n\tuseEffect(() => { if ( !instrument ) setInstrument( _.first( instruments ));}, [ instruments ]);\n    \n\tconst instrumentsVersionsPredictions = _.filter( versionsPredictions, [ \"instrument\", instrument ]);\n\n\treturn (\n\t\t<div className=\"body\">\n\t\t\t<div className=\"header\">\n\t\t\t\t<h1>Visualisation and Stats analysis of my ML model</h1>\n\t\t\t\t<p>All predictions pulled for my model, visualised and analysed.</p>\n\t\t\t</div>\n\n\t\t\t<div className=\"options\">\n\t\t\t\t<div>\n\t\t\t\t\t<p>Select Version:</p>\n\t\t\t\t\t<select value={ version } onChange={ e => setVersion( e.target.value )}>\n\t\t\t\t\t\t{ !_.isEmpty( versions ) && _.map( versions, version => <option key={ version } value={ version }>{ version }</option> ) }\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<p>Select Instruments:</p>\n\t\t\t\t\t<select value={ instrument } onChange={ e => setInstrument( e.target.value )}>\n\t\t\t\t\t\t{ !_.isEmpty( instruments ) && _.map( instruments, instrument => <option key={ instrument } value={ instrument }>{ instrument }</option> ) }\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{ ( loading || !version ) ? \n\t\t\t\t<div className=\"loader\">\n\t\t\t\t\t<FontAwesomeIcon icon={ faSpinner } spin size=\"3x\" />\n\t\t\t\t</div>\n\t\t\t\t:\n\t\t\t\t<>{ !_.isEmpty( instrumentsVersionsPredictions ) ?\n\t\t\t\t\t<div className=\"chart\">\n\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t<div className=\"stats\">\n\t\t\t\t\t\t\t<Stats data={ instrumentsVersionsPredictions } />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t<div className=\"scatter\">\n\t\t\t\t\t\t\t<DotChart data={ instrumentsVersionsPredictions } />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t<div className=\"distribution\">\n\t\t\t\t\t\t\t<DistributionChart data={ instrumentsVersionsPredictions } />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div> \n\t\t\t\t\t:\n\t\t\t\t\t<p>Nothing to display - change a filter!</p>\n\t\t\t\t}</>\n\t\t\t}\n\t\t</div>\n\t);\n}\n\nconst DotChart = memo( function DotChart ({ data }) {\n\tconst graphData = _.map( data, ({ actual, prediction }) => ({ actual: ( actual * 100 ).toFixed( 4 ), prediction: ( prediction * 100 ).toFixed( 4 ) }));\n\tconst regressionData = _.map( data, ({ actual, prediction }) => ([ actual * 100, prediction * 100 ]));\n\n\tconst largestVal = _.reduce( graphData, ( total, current ) => {\n\t\tconst actual = Math.abs( _.get( current, \"actual\" ));\n\t\tconst prediction = Math.abs( _.get( current, \"prediction\" ));\n\t\tif ( actual > prediction ) return actual > total ? actual : total;\n\t\treturn prediction > total ? prediction: total;\n\t}, -Infinity );\n\tconst domain = [ -1 * Math.ceil( largestVal * 2 ) / 2, 1 * Math.ceil( largestVal * 2 ) / 2 ];\n\n\tconst regressionLineFunc = linearRegressionLine( linearRegression( regressionData ));\n\tconst regressionLine = [\n\t\t{ actual: domain[ 0 ], prediction: regressionLineFunc( domain[ 0 ]) },\n\t\t{ actual: domain[ 1 ], prediction: regressionLineFunc( domain[ 1 ]) },\n\t];\n\n\treturn (\n\t\t<>\n\t\t\t<h3>Predictions vs Actuals scatter</h3>\n\t\t\t<ResponsiveContainer>\n\t\t\t\t<ScatterChart margin={{ top: 20, bottom: 20 }} data={ graphData }>\n\t\t\t\t\t<CartesianGrid />\n\t\t\t\t\t<XAxis type=\"number\" dataKey=\"actual\" name=\"actual\" domain={ domain } label={{ value: \"Actual Change (cents)\", position: \"bottom\", offset: 0 }} />\n\t\t\t\t\t<YAxis type=\"number\" dataKey=\"prediction\" name=\"prediction\" domain={ domain } label={{ value: \"Predicted Change (cents)\", position: \"centerBottom\", angle: -90, offset: 5 }} />\n\t\t\t\t\t<Tooltip cursor={{ strokeDasharray: \"3 3\" }} />\n\t\t\t\t\t<Scatter data={ graphData } fill=\"#82ca9d\" shape=\"triangle\" />\n\t\t\t\t\t<Scatter line={{ stroke: \"#e16162\", strokeWidth: 1 }} data={ regressionLine } shape=\"circle\" fill=\"#e16162\" />\n\t\t\t\t</ScatterChart>\n\t\t\t</ResponsiveContainer>\n\t\t</>\n\t);\n}, _.isEqual );\nDotChart.propTypes = {\n\tdata: PropTypes.array,\n};\n\nconst DistributionChart = memo( function DistributionChart ({ data }) {\n\tconst variations = _.map( data, ({ actual, prediction }) => Number(( actual - prediction ).toFixed( 4 )));\n\n\tconst numberOfIntervals = 20;\n\n\tconst smallest = min( variations );\n\tconst largest = max( variations );\n\tconst range = Math.abs( smallest - largest );\n\tconst intervalLength = range / numberOfIntervals; \n    \n\tconst graphData = _.map( _.range( 0, numberOfIntervals ), i => {\n\t\tconst bottom = Number(( smallest + intervalLength * i ).toFixed( 5 ));\n\t\tconst middle = Number(( smallest + intervalLength * ( i + 0.5 )).toFixed( 5 ));\n\t\tconst top = Number(( smallest + intervalLength * ( i + 1 )).toFixed( 5 )); \n\t\tconst matchedVariations = _.filter( variations, variation => variation > bottom && variation <= top );\n\t\treturn { \n\t\t\tname: middle,\n\t\t\tvalue: _.size( matchedVariations ),\n\t\t};\n\t});\n    \n\treturn (\n\t\t<>\n\t\t\t<h3>Variations distribution</h3>\n\t\t\t<ResponsiveContainer>\n\t\t\t\t<LineChart data={graphData} margin={{ top: 20, bottom: 20, left: -25 }} >\n\t\t\t\t\t<XAxis dataKey=\"name\" />\n\t\t\t\t\t<YAxis dataKey=\"value\" />\n\t\t\t\t\t<Tooltip />\n\t\t\t\t\t<Line type=\"monotone\" dataKey=\"value\" stroke=\"#82ca9d\" dot={ false } />\n\t\t\t\t</LineChart>\n\t\t\t</ResponsiveContainer>\n\t\t</>\n\t);\n}, _.isEqual );\nDistributionChart.propTypes = {\n\tdata: PropTypes.array,\n};\n\nconst Stats = ({ data }) => {\n\tconst sampleCount = _.size( data );\n\n\treturn (\n\t\t<>\n\t\t\t<h3>Basic Stats</h3>\n\t\t\t<div className=\"stats-row\">\n\t\t\t\t<div className=\"stats-col\">\n\t\t\t\t\t<h5>Number of Samples:</h5>\n\t\t\t\t\t<p>{ sampleCount }</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</>\n\t);\n};\nStats.propTypes = {\n\tdata: PropTypes.array,\n};\n","\nimport React from \"react\";\nimport Home from \"./Home\";\nimport { ApolloProvider } from \"@apollo/react-hooks\";\nimport ApolloClient from \"apollo-boost\";\n\n\nexport default function App () {\n\tconst client = new ApolloClient({\n\t\turi: \"https://boiling-ridge-24261.herokuapp.com/v1/graphql\",\n\t});\n\n\treturn (\n\t\t<ApolloProvider client={ client }>\n\t\t\t<Home />\n\t\t</ApolloProvider>\n\t);\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.scss\";\nimport App from \"./App\";\n\nReactDOM.render(\n\t<React.StrictMode>\n\t\t<App />\n\t</React.StrictMode>,\n\tdocument.getElementById( \"root\" ),\n);\n"],"sourceRoot":""}